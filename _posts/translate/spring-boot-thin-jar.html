<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.48">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>Spring Boot瘦身 | Beldon</title><meta name="description" content="Beldon">
    <link rel="modulepreload" href="/assets/app.6951aaec.js"><link rel="modulepreload" href="/assets/spring-boot-thin-jar.html.c49e7e5b.js"><link rel="modulepreload" href="/assets/spring-boot-thin-jar.html.0062b8e8.js"><link rel="prefetch" href="/assets/index.html.cf8fcc42.js"><link rel="prefetch" href="/assets/contributing.html.482fce6f.js"><link rel="prefetch" href="/assets/index.html.6487ab7c.js"><link rel="prefetch" href="/assets/one.html.18fdaa65.js"><link rel="prefetch" href="/assets/index.html.f234c912.js"><link rel="prefetch" href="/assets/two.html.672620f6.js"><link rel="prefetch" href="/assets/JDK命令行工具.html.373f382a.js"><link rel="prefetch" href="/assets/JVM(HotSpot) 7种垃圾收集器的特点及使用场景.html.0fd551d1.js"><link rel="prefetch" href="/assets/JVM运行时数据区.html.3a36f2c9.js"><link rel="prefetch" href="/assets/jsr133.html.64473f1f.js"><link rel="prefetch" href="/assets/垃圾回收算法.html.e9b18ae0.js"><link rel="prefetch" href="/assets/k8s-conception.html.22e54a8c.js"><link rel="prefetch" href="/assets/k8s-install.html.c36adb05.js"><link rel="prefetch" href="/assets/k8s-main.html.17271916.js"><link rel="prefetch" href="/assets/example.html.6394d926.js"><link rel="prefetch" href="/assets/404.html.265028f6.js"><link rel="prefetch" href="/assets/index.html.f2949449.js"><link rel="prefetch" href="/assets/contributing.html.cf9badb4.js"><link rel="prefetch" href="/assets/index.html.9cbdeb8a.js"><link rel="prefetch" href="/assets/one.html.21c75ce4.js"><link rel="prefetch" href="/assets/index.html.076792ce.js"><link rel="prefetch" href="/assets/two.html.280e21ae.js"><link rel="prefetch" href="/assets/JDK命令行工具.html.c42ebb5a.js"><link rel="prefetch" href="/assets/JVM(HotSpot) 7种垃圾收集器的特点及使用场景.html.ea138cb5.js"><link rel="prefetch" href="/assets/JVM运行时数据区.html.45d21e2d.js"><link rel="prefetch" href="/assets/jsr133.html.c99bc0b8.js"><link rel="prefetch" href="/assets/垃圾回收算法.html.fce6784e.js"><link rel="prefetch" href="/assets/k8s-conception.html.03d7f013.js"><link rel="prefetch" href="/assets/k8s-install.html.8e89225e.js"><link rel="prefetch" href="/assets/k8s-main.html.42e3cc55.js"><link rel="prefetch" href="/assets/example.html.ac0cd276.js"><link rel="prefetch" href="/assets/404.html.08a7d00f.js"><link rel="prefetch" href="/assets/404.0c79e1fa.js"><link rel="prefetch" href="/assets/Layout.eea7820e.js">
    <link rel="stylesheet" href="/assets/style.acf36ec1.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name">Beldon</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><!----><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">Spring Boot瘦身 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/_posts/translate/spring-boot-thin-jar.html#_1-介绍" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.介绍"><!--[--><!--]--> 1.介绍 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/_posts/translate/spring-boot-thin-jar.html#_2-先决条件" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.先决条件"><!--[--><!--]--> 2.先决条件 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/_posts/translate/spring-boot-thin-jar.html#_2-1-maven-项目" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.1 Maven 项目"><!--[--><!--]--> 2.1 Maven 项目 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/_posts/translate/spring-boot-thin-jar.html#_2-2-gradle-项目" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2 Gradle 项目"><!--[--><!--]--> 2.2 Gradle 项目 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/_posts/translate/spring-boot-thin-jar.html#_3-怎么创建一个thin-jar" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.怎么创建一个Thin Jar"><!--[--><!--]--> 3.怎么创建一个Thin Jar <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/_posts/translate/spring-boot-thin-jar.html#_4-基本用法" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.基本用法"><!--[--><!--]--> 4.基本用法 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/_posts/translate/spring-boot-thin-jar.html#_4-1-maven-项目" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.1 Maven 项目"><!--[--><!--]--> 4.1 Maven 项目 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/_posts/translate/spring-boot-thin-jar.html#_4-2-maven依赖-thin-properties" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.2 Maven依赖：thin.properties"><!--[--><!--]--> 4.2 Maven依赖：thin.properties <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/_posts/translate/spring-boot-thin-jar.html#_4-3-gradle项目" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.3 Gradle项目"><!--[--><!--]--> 4.3 Gradle项目 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/_posts/translate/spring-boot-thin-jar.html#_4-4-graldle依赖-pom-xml" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.4 Graldle依赖：pom.xml"><!--[--><!--]--> 4.4 Graldle依赖：pom.xml <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/_posts/translate/spring-boot-thin-jar.html#_4-5-gralde依赖-thin-properties" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.5 Gralde依赖：thin.properties"><!--[--><!--]--> 4.5 Gralde依赖：thin.properties <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/_posts/translate/spring-boot-thin-jar.html#_5-保存依赖" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.保存依赖"><!--[--><!--]--> 5.保存依赖 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/_posts/translate/spring-boot-thin-jar.html#_5-1-运行预热的程序" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.1 运行预热的程序"><!--[--><!--]--> 5.1 运行预热的程序 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/_posts/translate/spring-boot-thin-jar.html#_5-2-在构建的时候打包依赖" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.2 在构建的时候打包依赖"><!--[--><!--]--> 5.2 在构建的时候打包依赖 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/_posts/translate/spring-boot-thin-jar.html#_5-3-用maven打包依赖" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.3 用maven打包依赖"><!--[--><!--]--> 5.3 用maven打包依赖 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/_posts/translate/spring-boot-thin-jar.html#_5-4-用gradle打包依赖" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.4 用Gradle打包依赖"><!--[--><!--]--> 5.4 用Gradle打包依赖 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/_posts/translate/spring-boot-thin-jar.html#_6-总结和进一步阅读" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.总结和进一步阅读"><!--[--><!--]--> 6.总结和进一步阅读 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><p>Spring Boot出了名的把所有依赖打包成单个可执行的<strong>fat jar</strong>，同时也被广泛应用于微服务。有时候和<strong>fat jar</strong>不友好的是，反复包括相同的依赖会成为一种资源浪费。</p><h2 id="_1-介绍" tabindex="-1"><a class="header-anchor" href="#_1-介绍" aria-hidden="true">#</a> 1.介绍</h2><p>本教程中，我们将研究<strong>如何使用spring-boot-thin-launcher项目来将Spring Boot项目瘦身</strong>。</p><p>Spring Boot出了名的把所有依赖打包成单个可执行的<strong>Fat</strong> JAR，同时也被广泛应用于微服务。有时候和<strong>Fat</strong> JAR不一致的是，反复包括相同的依赖会成为一种资源浪费。</p><h2 id="_2-先决条件" tabindex="-1"><a class="header-anchor" href="#_2-先决条件" aria-hidden="true">#</a> 2.先决条件</h2><p>首先，我们当然需要一个Spring Boot项目。在本文中，我们将研究Maven构建和Gradle构建的最常见配置。</p><p>这里是不可能覆盖所有构建系统和相应的配置，但是希望我们能够有常用的构建系统配置以便参考。</p><h3 id="_2-1-maven-项目" tabindex="-1"><a class="header-anchor" href="#_2-1-maven-项目" aria-hidden="true">#</a> 2.1 Maven 项目</h3><p>用Maven 构建一个Spring Boot 项目，我们首先要在<strong>pom.xml</strong>或者它的parent等任何一个祖先添加Spring Boot的Maven插件:</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这里，我们指的是插件的版本<code>2.0.2.RELEASE</code>，这是编写本文时的最新版本。Spring Boot所用的依赖版本通常是用<strong>BOM</strong>或者从父的<strong>POM</strong>继承的了：</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.0.1.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>relativePath</span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-gradle-项目" tabindex="-1"><a class="header-anchor" href="#_2-2-gradle-项目" aria-hidden="true">#</a> 2.2 Gradle 项目</h3><p>用Gradle构建Spring Boot项目，我们会有相应的Gradle插件</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>buildscript {
    ext {
        springBootPlugin = &#39;org.springframework.boot:spring-boot-gradle-plugin&#39;
        springBootVersion = &#39;2.0.1.RELEASE&#39;
    }
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath(&quot;${springBootPlugin}:${springBootVersion}&quot;)
    }
} 
// elided
apply plugin: &#39;org.springframework.boot&#39;
apply plugin: &#39;io.spring.dependency-management&#39;
springBoot {
    mainClassName = &#39;DemoApplication&#39;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>请注意，本文只考虑Spring Boot 2.x或者更高的版本，Thin Launcher也支持旧的版本，但是可能有稍微不同的版本，具体请查看项目的主页。</p><h2 id="_3-怎么创建一个thin-jar" tabindex="-1"><a class="header-anchor" href="#_3-怎么创建一个thin-jar" aria-hidden="true">#</a> 3.怎么创建一个Thin Jar</h2><p>Spring Boot Thin Launcher是一个比较小的类库，它从打包的文件中读取项目工程的依赖关系，然后从maven仓库下载这些依赖，最后启动应用程序。所以在第一次启动下载相应依赖的时候会消耗一定的时间。</p><p>所以，当我们用库构建一个项目时，我们会得到一个包含代码的JAR文件，一个包含依赖关系的文件，以及执行入口的主类。</p><p>当然，事情会比我们简单的解析微妙得多，本文下面会继续探讨。</p><h2 id="_4-基本用法" tabindex="-1"><a class="header-anchor" href="#_4-基本用法" aria-hidden="true">#</a> 4.基本用法</h2><p>现在让我们看下如何构建一个<strong>thin</strong> jar的Spring Boot 项目。</p><p>我们将使用通常的java -jar 启动应用程序，并使用可选的附加命令行参数来控制 Thin Launcher。</p><p>我们将在以下部分中看到其中使用参数的几个例子; 该项目的主页包含完整参数列表。</p><h3 id="_4-1-maven-项目" tabindex="-1"><a class="header-anchor" href="#_4-1-maven-项目" aria-hidden="true">#</a> 4.1 Maven 项目</h3><p>在Maven项目中，我们必须修改SpringBoot的插件，添加相应的依赖：</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- The following enables the &quot;thin jar&quot; deployment option. --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot.experimental<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-thin-layout<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0.11.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Thin Launcher将会从Maven存储在JAR下的META-INF/maven`目录中生成的pom.xml文件读取依赖关系。</p><p><strong>我们像往常一样执行构建就行，例如使用 mvn install</strong></p><p>如果我们需要同时打包<strong>fat jar</strong>和<strong>thin jar</strong>，我们可以在maven的profile中定义springboot插件。</p><h3 id="_4-2-maven依赖-thin-properties" tabindex="-1"><a class="header-anchor" href="#_4-2-maven依赖-thin-properties" aria-hidden="true">#</a> 4.2 Maven依赖：thin.properties</h3><p><strong>除了pom.xml之外，我们也可以让maven生产thin.properties</strong>。在这种情况下，该文件会包含完整的依赖列表，包括可传递的依赖列表，但是相对pom.xml来说，thin Launcher对thin.properties更加友好。</p><p>默认情况下，插件在src/main/resources/META-INF中输出thin.properties，但是我们可以用thin.output属性来指定它的位置:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>mvn org.springframework.boot.experimental:spring-boot-thin-maven-plugin:properties -Dthin.output<span class="token operator">=</span>.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_4-3-gradle项目" tabindex="-1"><a class="header-anchor" href="#_4-3-gradle项目" aria-hidden="true">#</a> 4.3 Gradle项目</h3><p>不同的是，在Gradle项目中，我们需要添加了一个专用的插件：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>buildscript {
    ext {
        //...
        thinPlugin = &#39;org.springframework.boot.experimental:spring-boot-thin-gradle-plugin&#39;
        thinVersion = &#39;1.0.11.RELEASE&#39;
    }
    //...
    dependencies {
        //...
        classpath(&quot;${thinPlugin}:${thinVersion}&quot;)
    }
}
//elided
apply plugin: &#39;maven&#39;
apply plugin: &#39;org.springframework.boot.experimental.thin-launcher&#39;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>为了获取<strong>thin jar</strong>, 我们需要执行 <strong>thinJar</strong> 任务：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>./gradlew thinJar
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_4-4-graldle依赖-pom-xml" tabindex="-1"><a class="header-anchor" href="#_4-4-graldle依赖-pom-xml" aria-hidden="true">#</a> 4.4 Graldle依赖：pom.xml</h3><p>在前一小节的代码示例中，除了Thin Launcher之外，我们还声明了Maven插件（我们已经事先看到Spring Boot的依赖管理插件）</p><p>这是因为和我们之前的Maven案例一样，打包后的文件包含了一个<strong>pom.xml</strong>来列举应用程序所需要的依赖关系。pom.xml文件是由<strong>thinPom</strong>任务生成。</p><p><strong>我们可以用专门的一个任务来定制生成pom.xml</strong>, 在这里，我们复制下插件已经做的东西：</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code>task createPom {
    def basePath = &#39;build/resources/main/META-INF/maven&#39;
    doLast {
        pom {
            withXml(dependencyManagement.pomConfigurer)
        }.writeTo(&quot;${basePath}/${project.group}/${project.name}/pom.xml&quot;)
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>为了使用我们的自定义pom.xml文件，我们将上述任务添加到jar任务的依赖项中:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>bootJar.dependsOn = [createPom]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_4-5-gralde依赖-thin-properties" tabindex="-1"><a class="header-anchor" href="#_4-5-gralde依赖-thin-properties" aria-hidden="true">#</a> 4.5 Gralde依赖：thin.properties</h3><p><strong>和前面的maven项目已于，我们也可以让Gradle生成thin.properties而不是pom.xml</strong>, 生成thin.properties文件的任务叫做thinProperties，默认情况下是不使用它的。我们也可以把它添加到任务的依赖中：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>bootJar.dependsOn = [thinProperties]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_5-保存依赖" tabindex="-1"><a class="header-anchor" href="#_5-保存依赖" aria-hidden="true">#</a> 5.保存依赖</h2><p>thin jar的目的是为了避免依赖项和应用程序绑在一起，然后依赖是不会消失的，这些依赖只是存储在其他地方而已。</p><p>特别地，Thin Launcher是使用maven的基础架构来解决依赖的，所以：</p><ul><li>会检查本地的Maven仓库，默认是指 <code>~/.m2/repository</code>，当然也可以移到其他地方。</li><li>会从maven中央仓库中下载缺失的依赖</li><li>最后会缓存所下载的依赖到本地maven仓库中，下次启动的时候就不会再继续下载了。</li></ul><p>当然，下载依赖阶段是比较缓慢而且容易出错的部分，主要是因为是通过网络访问maven中央仓库来下载依赖，总之这些是不可靠的。</p><p>幸运的是，有很多种方式将依赖和应用程序一起部署，例如可以预打包在容器中。</p><h3 id="_5-1-运行预热的程序" tabindex="-1"><a class="header-anchor" href="#_5-1-运行预热的程序" aria-hidden="true">#</a> 5.1 运行预热的程序</h3><p>缓存依赖的最简单方法就是在目标环境中对程序进行预热运行。正如前面所说的，预热运行会把所依赖的文件缓存到本地的maven仓库中去。如果我们运行了多个应用程序，maven仓库中已经饱和了所依赖的库的话，就没有必要重复下载了。</p><p>由于运行应用程序可能会导致不必要的副作用，<strong>我们还可以执行“试运行”,它只解析和下载依赖项，而不运行任何用户代码:</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>java -Dthin.dryrun<span class="token operator">=</span>true -jar my-app-1.0.jar
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_5-2-在构建的时候打包依赖" tabindex="-1"><a class="header-anchor" href="#_5-2-在构建的时候打包依赖" aria-hidden="true">#</a> 5.2 在构建的时候打包依赖</h3><p>另外一个选择就是在构建的时候打包依赖，当然，这不是把依赖打包到JAR中，然后我们可以复制这些依赖到目标的环境中。</p><p>通常这会更加简单，因为没必要在目标环境中运行应用程序。但是，如果我们部署多个环境，就必须手动或用脚本合并他们的依赖关系。</p><p>在构建过程中，Maven和Gradle的Thin 插件打包的依赖格式与maven的本地仓库是一样的：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>root/
    repository/
        com/
        net/
        org/
        ...
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>实际上，我们还可以在运行的时候使用 thin.root参数来指定依赖的目录：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ java -jar my-app-1.0.jar --thin.root<span class="token operator">=</span>my-app/deps
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_5-3-用maven打包依赖" tabindex="-1"><a class="header-anchor" href="#_5-3-用maven打包依赖" aria-hidden="true">#</a> 5.3 用maven打包依赖</h3><p>为了能让maven帮我们打包依赖，我们需要添加 <code>spring-boot-thin-maven</code>插件</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot.experimental<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-thin-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${thin.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- Download the dependencies at build time --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>resolve<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>resolve<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>inherited</span><span class="token punctuation">&gt;</span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>inherited</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>构建项目后，我们将找到一个目录<code>target/thin/root/</code>会出现上一节讨论的结构。</p><h3 id="_5-4-用gradle打包依赖" tabindex="-1"><a class="header-anchor" href="#_5-4-用gradle打包依赖" aria-hidden="true">#</a> 5.4 用Gradle打包依赖</h3><p>如我们用<em>thin-launcher</em>插件，我们会有<em>thinResolve</em>任务可以用。这个任务会保存应用和它的依赖在<em>build/thin/root/</em> 目录中，跟maven的一样：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>gradlew thinResolve
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_6-总结和进一步阅读" tabindex="-1"><a class="header-anchor" href="#_6-总结和进一步阅读" aria-hidden="true">#</a> 6.总结和进一步阅读</h2><p>在这篇文章中，我们学习了如何制作Spring Boot的thin jar，同时也看到了如何使用maven的架构来下载和存储应用的依赖关系。</p><p>在<a href="https://github.com/dsyer/spring-boot-thin-launcher" target="_blank" rel="noopener noreferrer">项目主页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 也有一些其他的使用指导，好比如一些命令参数等。</p></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 1047325205@qq.com">beldon</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.6951aaec.js" defer></script>
  </body>
</html>
